"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5611],{5611:(t,e,a)=>{a.d(e,{clientDataService:()=>i});let r={PROJECTS:"RoadmapProjects",CATEGORIES:"RoadmapCategories",TEAM_MEMBERS:"RoadmapTeamMembers",SETTINGS:"RoadmapSettings",PROJECT_LINKS:"RoadmapProjectLinks"};class o{getWebUrl(){try{let t=window.location.origin,e=window.location.pathname.split("/"),a=e.findIndex(t=>"roadmapapp"===t.toLowerCase());if(-1!==a){let r=e.slice(0,a).join("/");return t+r}let r=e.findIndex(t=>"JSD"===t);if(-1!==r&&e[r+1]&&e[r+2]){let a=e.slice(0,r+3).join("/");return t+a}}catch(t){console.error("Error determining SharePoint web URL:",t)}return"https://spi.intranet.bs.ch/JSD/Digital"}async getRequestDigest(){let t=Date.now();if(this.requestDigestCache&&this.requestDigestCache.expiration>t)return this.requestDigestCache.value;try{let e=this.getWebUrl(),a=await fetch("".concat(e,"/_api/contextinfo"),{method:"POST",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!a.ok){let t=await a.text();throw console.error("Request Digest Error Response:",{status:a.status,statusText:a.statusText,url:a.url,body:t}),Error("Failed to get request digest: ".concat(a.statusText))}let r=await a.json(),o=r.FormDigestValue,i=1e3*r.FormDigestTimeoutSeconds;return this.requestDigestCache={value:o,expiration:t+i-6e4},o}catch(t){throw console.error("Error getting request digest:",t),t}}async fetchFromSharePoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*",a=this.getWebUrl(),r="".concat(a,"/_api/web/lists/getByTitle('").concat(t,"')/items?$select=").concat(e);try{let t=await fetch(r,{method:"GET",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!t.ok){let e=await t.text();throw console.error("SharePoint API Error Response:",{status:t.status,statusText:t.statusText,url:t.url,body:e}),Error("SharePoint request failed: ".concat(t.statusText))}return(await t.json()).value||[]}catch(e){throw console.error("Error fetching from SharePoint list ".concat(t,":"),e),e}}async getListMetadata(t){if(this.metadataCache[t])return this.metadataCache[t];try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(t,"')?$select=ListItemEntityTypeFullName"),r=await fetch(a,{method:"GET",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!r.ok){let t=await r.text();throw console.error("List Metadata Error Response:",{status:r.status,statusText:r.statusText,url:r.url,body:t}),Error("Failed to get list metadata: ".concat(r.statusText))}let o=(await r.json()).ListItemEntityTypeFullName;return this.metadataCache[t]=o,o}catch(a){console.error("Error getting metadata for list ".concat(t,":"),a);let e="SP.Data.".concat(t,"ListItem");return this.metadataCache[t]=e,e}}async getAllProjects(){try{let t=(await this.fetchFromSharePoint(r.PROJECTS,"Id,Title,Category,StartQuarter,EndQuarter,Description,Status,Projektleitung,Bisher,Zukunft,Fortschritt,GeplantUmsetzung,Budget,StartDate,EndDate")).map(t=>{var e;return{id:t.Id.toString(),title:t.Title,category:t.Category,startQuarter:t.StartQuarter,endQuarter:t.EndQuarter,description:t.Description||"",status:(null===(e=t.Status)||void 0===e?void 0:e.toLowerCase())||"planned",ProjectFields:t.Fields||[],projektleitung:t.Projektleitung||"",bisher:t.Bisher||"",zukunft:t.Zukunft||"",fortschritt:t.Fortschritt||0,geplante_umsetzung:t.GeplantUmsetzung||"",budget:t.Budget||"",startDate:t.StartDate||"",endDate:t.EndDate||"",links:[]}});for(let e of t)e.links=await this.getProjectLinks(e.id);return t}catch(t){return console.error("Error fetching projects:",t),[]}}async getProjectById(t){try{var e;let a=this.getWebUrl(),o="".concat(a,"/_api/web/lists/getByTitle('").concat(r.PROJECTS,"')/items(").concat(t,")?$select=Id,Title,Category,StartQuarter,EndQuarter,Description,Status,Projektleitung,Bisher,Zukunft,Fortschritt,GeplantUmsetzung,Budget,StartDate,EndDate,ProjectFields"),i=await fetch(o,{method:"GET",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!i.ok){let t=await i.text();throw console.error("Project Fetch Error Response:",{status:i.status,statusText:i.statusText,url:i.url,body:t}),Error("Failed to fetch project: ".concat(i.statusText))}let s=await i.json(),n=await this.getTeamMembersForProject(s.Id.toString()),c=[];s.ProjectFields&&("string"==typeof s.ProjectFields?c=s.ProjectFields.includes(";")||s.ProjectFields.includes(",")?s.ProjectFields.split(/[;,]/).map(t=>t.trim()).filter(Boolean):[s.ProjectFields]:Array.isArray(s.ProjectFields)&&(c=s.ProjectFields));let l={id:s.Id.toString(),title:s.Title,category:s.Category,startQuarter:s.StartQuarter,endQuarter:s.EndQuarter,description:s.Description||"",status:(null===(e=s.Status)||void 0===e?void 0:e.toLowerCase())||"planned",ProjectFields:c||"",projektleitung:s.Projektleitung||"",projektleitungImageUrl:null,teamMembers:n,bisher:s.Bisher||"",zukunft:s.Zukunft||"",fortschritt:s.Fortschritt||0,geplante_umsetzung:s.GeplantUmsetzung||"",budget:s.Budget||"",startDate:s.StartDate||"",endDate:s.EndDate||"",links:await this.getProjectLinks(s.Id.toString())},d="";if(l.projektleitung&&l.projektleitung.trim()){let e=l.projektleitung.split(" ");e.length>=2?d=e[0].toLowerCase()+"."+e[1].toLowerCase()+"@jsd.bs.ch":(d=e[0].toLowerCase()+"@jsd.bs.ch",console.log("Project ".concat(t," has incomplete projektleitung format: ").concat(l.projektleitung)))}return d&&(l.projektleitungImageUrl=await this.getUserProfilePictureUrl(d)),l}catch(e){return console.error("Error fetching project ".concat(t,":"),e),null}}async deleteProject(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.PROJECTS,"')/items(").concat(t,")"),o=await this.getRequestDigest(),i=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-HTTP-Method":"DELETE","IF-MATCH":"*","X-RequestDigest":o},credentials:"same-origin"});if(!i.ok){let t=await i.text();throw console.error("Project Delete Error Response:",{status:i.status,statusText:i.statusText,url:i.url,body:t}),Error("Failed to delete project: ".concat(i.statusText))}await this.deleteTeamMembersForProject(t),await this.deleteProjectLinks(t)}catch(e){throw console.error("Error deleting project ".concat(t,":"),e),e}}async updateProject(t,e){try{let a=await this.getProjectById(t);if(!a)throw Error("Project with ID ".concat(t," not found"));let o=this.getWebUrl(),i="".concat(o,"/_api/web/lists/getByTitle('").concat(r.PROJECTS,"')/items(").concat(t,")"),s=await this.getRequestDigest(),n=await this.getListMetadata(r.PROJECTS),c="";void 0!==e.ProjectFields?Array.isArray(e.ProjectFields)?c=e.ProjectFields.join("; "):"string"==typeof e.ProjectFields?c=e.ProjectFields:e.ProjectFields&&(c=String(e.ProjectFields)):a.ProjectFields&&(c=Array.isArray(a.ProjectFields)?a.ProjectFields.join("; "):String(a.ProjectFields));let l={__metadata:{type:n},Title:e.title||a.title||"",Category:e.category||a.category||"",StartQuarter:e.startQuarter||a.startQuarter||"",EndQuarter:e.endQuarter||a.endQuarter||"",Description:e.description||a.description||"",Status:e.status||a.status||"planned",Projektleitung:e.projektleitung||a.projektleitung||"",Bisher:e.bisher||a.bisher||"",Zukunft:e.zukunft||a.zukunft||"",Fortschritt:"number"==typeof e.fortschritt?e.fortschritt:a.fortschritt||0,GeplantUmsetzung:e.geplante_umsetzung||a.geplante_umsetzung||"",Budget:e.budget||a.budget||"",StartDate:e.startDate||a.startDate||"",EndDate:e.endDate||a.endDate||"",ProjectFields:c};console.log("Data being sent to SharePoint:",JSON.stringify(l));let d=await fetch(i,{method:"POST",headers:{Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","IF-MATCH":"*","X-RequestDigest":s},body:JSON.stringify(l),credentials:"same-origin"});if(!d.ok){let t="";try{let e=await d.text();t=e,console.error("SharePoint Error Response:",{status:d.status,statusText:d.statusText,url:d.url,body:e})}catch(e){t="Could not read error details"}throw Error("Failed to update project: ".concat(d.statusText,". Details: ").concat(t))}return{...a,...e,id:t}}catch(e){throw console.error("Error updating project ".concat(t,":"),e),e}}async createProject(t){try{let e={...t,id:"new",links:t.links||[]};return await this.saveProject(e)}catch(t){throw console.error("Error creating project:",t),t}}async createCategory(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.CATEGORIES,"')/items"),o=await this.getRequestDigest(),i=await this.getListMetadata(r.CATEGORIES),s=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-RequestDigest":o},body:JSON.stringify({__metadata:{type:i},Title:t.name,Color:t.color,Icon:t.icon,ParentCategoryId:t.parentId,IsSubcategory:t.isSubcategory}),credentials:"same-origin"});if(!s.ok)throw Error("Failed to create category: ".concat(s.statusText));return{id:(await s.json()).Id.toString(),name:t.name,color:t.color,icon:t.icon,parentId:t.parentId,isSubcategory:t.isSubcategory}}catch(t){throw console.error("Error creating category:",t),t}}async updateCategory(t,e){try{let a=this.getWebUrl(),o="".concat(a,"/_api/web/lists/getByTitle('").concat(r.CATEGORIES,"')/items(").concat(t,")"),i=await this.getRequestDigest(),s=await this.getListMetadata(r.CATEGORIES),n=await fetch(o,{method:"POST",headers:{Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","IF-MATCH":"*","X-RequestDigest":i},body:JSON.stringify({__metadata:{type:s},Title:e.name,Color:e.color,Icon:e.icon,ParentCategoryId:e.parentId,IsSubcategory:e.isSubcategory}),credentials:"same-origin"});if(!n.ok)throw Error("Failed to update category: ".concat(n.statusText));return{id:t,name:e.name||"",color:e.color||"",icon:e.icon||"",parentId:e.parentId,isSubcategory:e.isSubcategory}}catch(e){throw console.error("Error updating category ".concat(t,":"),e),e}}async getAllCategories(){try{return(await this.fetchFromSharePoint(r.CATEGORIES,"Id,Title,Color,Icon,ParentCategoryId,IsSubcategory")).map(t=>({id:t.Id.toString(),name:t.Title,color:t.Color,icon:t.Icon||"",parentId:t.ParentCategoryId?t.ParentCategoryId.toString():void 0,isSubcategory:!0===t.IsSubcategory}))}catch(t){return console.error("Error fetching categories:",t),[]}}async getCategoryById(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.CATEGORIES,"')/items(").concat(t,")?$select=Id,Title,Color,Icon,ParentCategoryId,IsSubcategory"),o=await fetch(a,{method:"GET",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!o.ok)throw Error("Failed to fetch category: ".concat(o.statusText));let i=await o.json();return{id:i.Id.toString(),name:i.Title,color:i.Color,icon:i.Icon||"",parentId:i.ParentCategoryId?i.ParentCategoryId.toString():void 0,isSubcategory:!0===i.IsSubcategory}}catch(e){return console.error("Error fetching category ".concat(t,":"),e),null}}async getProjectLinks(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.PROJECT_LINKS,"')/items?$filter=ProjectId eq '").concat(t,"'&$select=Id,Title,Url,ProjectId"),o=await fetch(a,{method:"GET",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!o.ok)throw Error("Failed to fetch project links: ".concat(o.statusText));return((await o.json()).value||[]).map(t=>({id:t.Id.toString(),title:t.Title,url:t.Url,projectId:t.ProjectId}))}catch(e){return console.error("Error fetching links for project ".concat(t,":"),e),[]}}async deleteCategory(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.CATEGORIES,"')/items(").concat(t,")"),o=await this.getRequestDigest(),i=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","X-HTTP-Method":"DELETE","IF-MATCH":"*","X-RequestDigest":o},credentials:"same-origin"});if(!i.ok)throw Error("Failed to delete category: ".concat(i.statusText))}catch(e){throw console.error("Error deleting category ".concat(t,":"),e),e}}async createProjectLink(t){try{var e;let a;let o=this.getWebUrl(),i="".concat(o,"/_api/web/lists/getByTitle('").concat(r.PROJECT_LINKS,"')/items"),s=await this.getRequestDigest();a={__metadata:{type:await this.getListMetadata(r.PROJECT_LINKS)},Title:t.title,Url:t.url,ProjectId:t.projectId},console.log("Creating project link with data:",JSON.stringify(a));let n=await fetch(i,{method:"POST",headers:{Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-RequestDigest":s},body:JSON.stringify(a),credentials:"same-origin"});if(!n.ok){let t="";try{let e=await n.text();t=e,console.error("SharePoint Error Response for createProjectLink:",{status:n.status,statusText:n.statusText,url:n.url,body:e,requestBody:a})}catch(e){t="Could not read error details"}throw Error("Failed to create project link: ".concat(n.statusText,". Details: ").concat(t))}let c=await n.json();return{id:(null===(e=c.Id)||void 0===e?void 0:e.toString())||"",title:c.Title||t.title,url:c.Url||t.url,projectId:c.ProjectId||t.projectId}}catch(t){throw console.error("Error creating project link:",t),t}}async updateProjectLink(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.PROJECT_LINKS,"')/items(").concat(t.id,")"),o=await this.getRequestDigest(),i=await this.getListMetadata(r.PROJECT_LINKS),s=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","IF-MATCH":"*","X-RequestDigest":o},body:JSON.stringify({__metadata:{type:i},Title:t.title,Url:t.url,ProjectId:t.projectId}),credentials:"same-origin"});if(!s.ok)throw Error("Failed to update project link: ".concat(s.statusText));return t}catch(e){throw console.error("Error updating project link ".concat(t.id,":"),e),e}}async deleteProjectLink(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.PROJECT_LINKS,"')/items(").concat(t,")"),o=await this.getRequestDigest(),i=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","X-HTTP-Method":"DELETE","IF-MATCH":"*","X-RequestDigest":o},credentials:"same-origin"});if(!i.ok)throw Error("Failed to delete project link: ".concat(i.statusText))}catch(e){throw console.error("Error deleting project link ".concat(t,":"),e),e}}async deleteProjectLinks(t){try{for(let e of(await this.getProjectLinks(t)))await this.deleteProjectLink(e.id)}catch(e){throw console.error("Error deleting links for project ".concat(t,":"),e),e}}async saveProject(t){try{let e;let a=this.getWebUrl(),o=!t.id||"new"===t.id,i=await this.getRequestDigest(),s=await this.getListMetadata(r.PROJECTS),n={...t},c=n.links||[];delete n.links,n.teamMembers,delete n.teamMembers;let l=o?"".concat(a,"/_api/web/lists/getByTitle('").concat(r.PROJECTS,"')/items"):"".concat(a,"/_api/web/lists/getByTitle('").concat(r.PROJECTS,"')/items(").concat(t.id,")"),d={Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-RequestDigest":i};o||(d["X-HTTP-Method"]="MERGE",d["IF-MATCH"]="*");let u={__metadata:{type:s},Title:n.title,Category:n.category,StartQuarter:n.startQuarter,EndQuarter:n.endQuarter,Description:n.description,Status:n.status,Projektleitung:n.projektleitung,Bisher:n.bisher,Zukunft:n.zukunft,Fortschritt:n.fortschritt,GeplantUmsetzung:n.geplante_umsetzung,Budget:n.budget,StartDate:n.startDate,EndDate:n.endDate,ProjectFields:(t=>{if(!t)return"";if(Array.isArray(t))return t.map(t=>String(t).trim()).filter(Boolean).join("; ");let e=String(t);return e.includes(";")||e.includes(",")?e.split(/[;,]/).map(t=>t.trim()).filter(Boolean).join("; "):e.trim()})(n.ProjectFields)},g=await fetch(l,{method:"POST",headers:d,body:JSON.stringify(u),credentials:"same-origin"});if(!g.ok){let t=await g.text();throw console.error("Project Save Error Response:",{status:g.status,statusText:g.statusText,url:g.url,body:t}),Error("Failed to save project: ".concat(g.statusText))}if(o){let t=await g.json();e={...n,id:t.Id.toString(),links:[],teamMembers:[]}}else e={...n,id:t.id,links:[],teamMembers:[]};if(c&&c.length>0){for(let t of(await this.deleteProjectLinks(e.id),c))await this.createProjectLink({title:t.title,url:t.url,projectId:e.id});e.links=c}return e}catch(t){throw console.error("Error saving project:",t),t}}async getUserProfilePictureUrl(t){try{let e=this.getWebUrl(),a=t;a=t.includes("@")?"i:0#.f|membership|".concat(t):"i:0#.w|".concat(t);let r=encodeURIComponent("'".concat(a,"'")),o="".concat(e,"/_api/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v=").concat(r),i=await fetch(o,{method:"GET",headers:{Accept:"application/json;odata=verbose"},credentials:"same-origin"});if(!i.ok)return console.warn("Could not find user profile for ".concat(t,": ").concat(i.statusText)),null;let s=await i.json();if(s&&s.d&&s.d.PictureUrl)return s.d.PictureUrl;let n="".concat(e,"/_layouts/15/userphoto.aspx?size=L&accountname=").concat(encodeURIComponent(t));if((await fetch(n,{method:"HEAD",credentials:"same-origin"})).ok)return n;return null}catch(e){return console.warn("Error getting profile picture for ".concat(t,":"),e),null}}async getTeamMembersForProject(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.TEAM_MEMBERS,"')/items?$filter=ProjectId eq '").concat(t,"'&$select=Id,Title,Role,ProjectId"),o=await fetch(a,{method:"GET",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!o.ok)throw Error("Failed to fetch team members: ".concat(o.statusText));let i=((await o.json()).value||[]).map(e=>{var a;return{id:(null===(a=e.Id)||void 0===a?void 0:a.toString())||"",name:e.Title||"",role:e.Role||"Teammitglied",projectId:e.ProjectId||t,userIdentifier:e.Title||"",imageUrl:null}});return await Promise.all(i.map(async t=>{if(t.userIdentifier){let e=t.userIdentifier.split(" ");if(e.length>=2&&e[0]&&e[1]){let a=e[0].toLowerCase()+"."+e[1].toLowerCase()+"@jsd.bs.ch";a&&(t.imageUrl=await this.getUserProfilePictureUrl(a))}}})),i}catch(e){return console.error("Error fetching team members for project ".concat(t,":"),e),[]}}async deleteTeamMembersForProject(t){try{for(let e of(await this.getTeamMembersForProject(t)))e.id&&await this.deleteTeamMember(e.id)}catch(e){throw console.error("Error deleting team members for project ".concat(t,":"),e),e}}async createTeamMember(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.TEAM_MEMBERS,"')/items"),o=await this.getRequestDigest(),i=await this.getListMetadata(r.TEAM_MEMBERS),s=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-RequestDigest":o},body:JSON.stringify({__metadata:{type:i},Title:t.name,Role:t.role,ProjectId:t.projectId}),credentials:"same-origin"});if(!s.ok)throw Error("Failed to create team member: ".concat(s.statusText));return{id:(await s.json()).Id.toString(),name:t.name,role:t.role,projectId:t.projectId}}catch(t){throw console.error("Error creating team member:",t),t}}async deleteTeamMember(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.TEAM_MEMBERS,"')/items(").concat(t,")"),o=await this.getRequestDigest(),i=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","X-HTTP-Method":"DELETE","IF-MATCH":"*","X-RequestDigest":o},credentials:"same-origin"});if(!i.ok)throw Error("Failed to delete team member: ".concat(i.statusText))}catch(e){throw console.error("Error deleting team member ".concat(t,":"),e),e}}async createSetting(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.SETTINGS,"')/items"),o=await this.getRequestDigest(),i=await this.getListMetadata(r.SETTINGS),s=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-RequestDigest":o},body:JSON.stringify({__metadata:{type:i},Title:t.key,Value:t.value,Description:t.description||""}),credentials:"same-origin"});if(!s.ok)throw Error("Failed to create setting: ".concat(s.statusText));return{id:(await s.json()).Id.toString(),key:t.key,value:t.value,description:t.description}}catch(t){throw console.error("Error creating setting:",t),t}}async getAppSettings(){try{return(await this.fetchFromSharePoint(r.SETTINGS,"Id,Title,Value,Description")).map(t=>({id:t.Id.toString(),key:t.Title,value:t.Value||"",description:t.Description}))}catch(t){return console.error("Error fetching app settings:",t),[{id:"1",key:"defaultSettings",value:JSON.stringify({theme:"dark",defaultView:"quarters",showCompletedProjects:!0,enableNotifications:!1,customColors:{}}),description:"Default application settings"}]}}async getSettingByKey(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.SETTINGS,"')/items?$filter=Title eq '").concat(t,"'&$select=Id,Title,Value,Description"),o=await fetch(a,{method:"GET",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!o.ok)throw Error("Failed to fetch setting: ".concat(o.statusText));let i=(await o.json()).value||[];if(0===i.length)return null;let s=i[0];return{id:s.Id.toString(),key:s.Title,value:s.Value||"",description:s.Description||""}}catch(e){return console.error("Error fetching setting with key ".concat(t,":"),e),null}}async updateSetting(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.SETTINGS,"')/items(").concat(t.id,")"),o=await this.getRequestDigest(),i=await this.getListMetadata(r.SETTINGS),s=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","Content-Type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","IF-MATCH":"*","X-RequestDigest":o},body:JSON.stringify({__metadata:{type:i},Title:t.key,Value:t.value,Description:t.description||""}),credentials:"same-origin"});if(!s.ok)throw Error("Failed to update setting: ".concat(s.statusText));return t}catch(e){throw console.error("Error updating setting ".concat(t.id,":"),e),e}}async deleteSetting(t){try{let e=this.getWebUrl(),a="".concat(e,"/_api/web/lists/getByTitle('").concat(r.SETTINGS,"')/items(").concat(t,")"),o=await this.getRequestDigest(),i=await fetch(a,{method:"POST",headers:{Accept:"application/json;odata=nometadata","X-HTTP-Method":"DELETE","IF-MATCH":"*","X-RequestDigest":o},credentials:"same-origin"});if(!i.ok)throw Error("Failed to delete setting: ".concat(i.statusText))}catch(e){throw console.error("Error deleting setting ".concat(t,":"),e),e}}async isCurrentUserAdmin(){try{let t=this.getWebUrl(),e=await fetch("".concat(t,"/_api/web/currentuser"),{method:"GET",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!e.ok)throw Error("Failed to get current user: ".concat(e.statusText));let a=await e.json();if(!0===a.IsSiteAdmin)return!0;let r="".concat(t,"/_api/web/sitegroups/getByName('").concat("Roadmap Administrators","')/users?$filter=Id eq ").concat(a.Id),o=await fetch(r,{method:"GET",headers:{Accept:"application/json;odata=nometadata"},credentials:"same-origin"});if(!o.ok)return!1;let i=await o.json();return i.value&&i.value.length>0}catch(t){return console.error("Error checking admin status:",t),!1}}async searchUsers(t){try{if(!t||t.trim().length<2)return[];let e=this.getWebUrl(),a=await this.getRequestDigest(),r=await fetch("".concat(e,"/_api/SP.UI.ApplicationPages.ClientPeoplePickerWebServiceInterface.clientPeoplePickerSearchUser"),{method:"POST",headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":a},body:JSON.stringify({queryParams:{AllowEmailAddresses:!0,AllowMultipleEntities:!1,AllUrlZones:!1,MaximumEntitySuggestions:20,PrincipalSource:15,PrincipalType:1,QueryString:t}}),credentials:"same-origin"});if(!r.ok)throw Error("Failed to search users: ".concat(r.statusText));let o=await r.json();return JSON.parse(o.d.ClientPeoplePickerSearchUser).map(t=>{var e,a;let r=t.DisplayText||"";if(r.includes(",")){let t=r.split(",").map(t=>t.trim());r="".concat(t[1]," ").concat(t[0])}return{id:t.Key||(null===(e=t.EntityData)||void 0===e?void 0:e.SPUserID)||"user-".concat(Date.now()),name:r,role:"Teammitglied",email:(null===(a=t.EntityData)||void 0===a?void 0:a.Email)||"",userIdentifier:t.Key||"",imageUrl:null}})}catch(t){return console.error("Error searching users:",t),[]}}constructor(){this.metadataCache={},this.requestDigestCache=null}}let i=new o}}]);