(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5037],{548:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(7876),i=r(4232),s=r(9099),l=r(8230),o=r.n(l),n=r(8841),c=r(3999),d=r(5611),m=r(6815);let g=(0,c.A)(()=>{let e=(0,s.useRouter)(),{id:t}=e.query,[r,l]=(0,i.useState)(null),[c,g]=(0,i.useState)([]),[u,h]=(0,i.useState)([]),[p,b]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(async()=>{if(t&&"string"==typeof t){b(!0);try{let[e,r,a]=await Promise.all([d.clientDataService.getProjectById(t),d.clientDataService.getAllCategories(),d.clientDataService.getTeamMembersForProject(t)]);l(e),g(r),h(a)}catch(e){console.error("Error fetching data:",e)}finally{b(!1)}}})()},[t]);let j=async t=>{try{let r={id:t.id,title:t.title||"",category:t.category||"",startQuarter:t.startQuarter||"",endQuarter:t.endQuarter||"",description:t.description||"",status:t.status||"planned",projektleitung:t.projektleitung||"",bisher:t.bisher||"",zukunft:t.zukunft||"",fortschritt:"number"==typeof t.fortschritt?t.fortschritt:0,geplante_umsetzung:t.geplante_umsetzung||"",budget:t.budget||"",startDate:"",endDate:"",ProjectFields:[]};if(t.startDate)try{let e=new Date(t.startDate);isNaN(e.getTime())||(r.startDate=e.toISOString().split("T")[0]+"T00:00:00Z")}catch(e){console.error("Fehler beim Formatieren des Startdatums:",e)}if(t.endDate)try{let e=new Date(t.endDate);isNaN(e.getTime())||(r.endDate=e.toISOString().split("T")[0]+"T00:00:00Z")}catch(e){console.error("Fehler beim Formatieren des Enddatums:",e)}if(t.ProjectFields){if(Array.isArray(t.ProjectFields))r.ProjectFields=t.ProjectFields.map(e=>String(e));else if("string"==typeof t.ProjectFields){let e=t.ProjectFields;e.includes(";")||e.includes(",")?r.ProjectFields=e.split(/[;,]/).map(e=>e.trim()).filter(Boolean):r.ProjectFields=[e]}else r.ProjectFields=[String(t.ProjectFields)]}let a=t.teamMembers&&Array.isArray(t.teamMembers)?t.teamMembers.map(e=>"string"==typeof e?{name:e,role:"Teammitglied"}:{name:e.name,role:e.role||"Teammitglied"}):[];console.log("Projekt vor dem Speichern:",r),console.log("Team members to save:",a);let i=await d.clientDataService.updateProject(r.id,r);if(console.log("Gespeichertes Projekt:",i),a.length>0)try{for(let e of(await d.clientDataService.deleteTeamMembersForProject(i.id),console.log("Existing team members deleted"),a)){let t=e.name,r=e.role||"Teammitglied";t&&(console.log("Creating team member: ".concat(t," with role ").concat(r)),await d.clientDataService.createTeamMember({name:t,role:r,projectId:i.id}))}console.log("New team members created")}catch(e){console.error("Error updating team members:",e)}else try{await d.clientDataService.deleteTeamMembersForProject(i.id),console.log("Existing team members deleted (no new members to add)")}catch(e){console.error("Error deleting team members:",e)}if(t.links&&Array.isArray(t.links)&&t.links.length>0)try{for(let e of(await d.clientDataService.deleteProjectLinks(i.id),console.log("Existing project links deleted"),t.links))"object"==typeof e&&e.title&&e.url&&(console.log("Creating link: ".concat(e.title," with URL ").concat(e.url)),await d.clientDataService.createProjectLink({title:e.title,url:e.url,projectId:i.id}));console.log("New project links created")}catch(e){console.error("Error updating links:",e)}e.push("/admin")}catch(e){console.error("Error saving project:",e),alert("Fehler beim Speichern des Projekts: "+(e instanceof Error?e.message:String(e)))}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white",children:[(0,a.jsx)("header",{className:"bg-gray-800 py-4 px-6 border-b border-gray-700",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Projekt bearbeiten"}),(0,a.jsx)(o(),{href:"/admin",children:(0,a.jsx)("button",{className:"bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded transition-colors",children:"Zur\xfcck zum Dashboard"})})]})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"bg-gray-800 rounded-lg shadow p-6",children:p?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)(m.lM,{visible:!0,height:"80",width:"80",color:"#60a5fa",ariaLabel:"triangle-loading",wrapperStyle:{},wrapperClass:""})}):t&&"string"==typeof t&&r?(0,a.jsx)(n.A,{initialProject:{...r,teamMembers:u.map(e=>({name:e.name,role:e.role,projectId:e.projectId,id:e.id}))},categories:c,onSubmit:j,onCancel:()=>{e.push("/admin")}}):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("p",{children:"Projekt-ID nicht gefunden. Bitte versuchen Sie es erneut."}),(0,a.jsx)("button",{onClick:()=>e.push("/admin"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Zur\xfcck zum Dashboard"})]})})})]})})},1030:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/projects/edit/[id]",function(){return r(548)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[4938,8513,1215,1121,6701,9008,1126,7232,1901,5611,7079,636,6593,8792],()=>t(1030)),_N_E=e.O()}]);